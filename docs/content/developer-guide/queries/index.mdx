# Queries

Queries are the primary way to interact with ARK's AI agents, teams, models, and tools. They represent requests to execute tasks and receive responses from AI systems.

## Overview

A Query resource contains:
- **Input**: The prompt or question to send to the target
- **Targets**: One or more agents, teams, models, or tools to execute against
- **Parameters**: Optional values to customize execution
- **Memory**: Optional conversation context
- **Session**: Optional session grouping for related queries

## Message Construction

ARK constructs messages for LLM API calls by:

1. **Creating a fresh system message** with the current agent's prompt
2. **Loading conversation history** from memory (if specified)
3. **Adding the current query input** as a user message

### Key Behaviors

- **System Message Replacement**: Each query creates a fresh system message, replacing any previous system messages
- **Memory Integration**: Conversation history is loaded and included in the context
- **Team Coordination**: Teams coordinate multiple agents, each receiving their own system message
- **No Duplicate System Messages**: ARK ensures only one system message per LLM API call

### Single Agent Queries

```json
[
  {"role": "system", "content": "You are a helpful assistant"},
  {"role": "user", "content": "What's the weather?"},
  {"role": "assistant", "content": "It's sunny today"},
  {"role": "user", "content": "What about tomorrow?"}
]
```

### Team Queries

Each agent in a team receives its own system message:

```json
Agent A:
[
  {"role": "system", "content": "You are Agent A - data analyst"},
  {"role": "user", "content": "Analyze this data"},
  {"role": "assistant", "content": "Here's my analysis..."},
  {"role": "user", "content": "What are the trends?"}
]

Agent B:
[
  {"role": "system", "content": "You are Agent B - business consultant"},
  {"role": "user", "content": "Analyze this data"},
  {"role": "assistant", "content": "Here's my analysis..."},
  {"role": "user", "content": "What are the trends?"}
]
```

## Execution Flow

1. **Query Creation**: User creates Query resource with input and targets
2. **Controller Processing**: Query controller orchestrates execution
3. **Target Execution**: Each target (agent/team) processes the query
4. **Response Generation**: AI models generate responses
5. **Memory Storage**: Conversation is stored in memory (if configured)

## Best Practices

- **Use meaningful session IDs** to group related conversations
- **Specify memory resources** for persistent conversation context
- **Set appropriate timeouts** for long-running queries
- **Use parameters** to customize agent behavior
- **Leverage teams** for complex multi-agent workflows

## Related Resources

- [Query Resource Reference](/reference/resources/query)
- [Memory Integration](/reference/resources/memory)
- [Agent Configuration](/reference/resources/agent)
- [Team Strategies](/reference/resources/team)
